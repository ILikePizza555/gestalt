<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>The Hive Connected</title>
		<link type="text/css" rel="stylesheet" href="static/normalize.css">
		<style type="text/css">
			body {
				height: 100vh;
				display: flex;
				justify-content: center;
			}

			main.container {
				max-width: 768px;
				margin: 10px;
				flex-grow: 1;

				display: flex;
				flex-direction: column;
			}

			#chat {
				flex-grow: 1;
			}

			.chat-input-section {
				display: flex;
			}

			#chat-input {
				flex-grow: 1;
			}
		</style>
	</head>
	<body>
		<main class="container">
			<h1>Our Words</h1>
			<section id="chat"></section>
			<form id="input-form" class="chat-input-section">
				<input type="text" id="chat-input" placeholder="What do we say?">
				<input type="submit" value="Send">
			</form>
		</main>

		<template id="message-template">
			<div class="message">
				<span class="author"></span>:<span class="contents"></span>
			</div>
		</template>

		<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
		<script>
			"use strict";

			function CreateMessageView(author, contents, authorColor) {
				const messageTemplate = document.getElementById("message-template");

				const clone = messageTemplate.content.cloneNode(true);

				const authorElement = clone.querySelector(".author");
				authorElement.textContent = author;
				authorElement.style.color = authorColor;

				clone.querySelector(".content").textContent = contents;

				return clone;
			}

			const socket = io();

			socket.on("message", function messageHandler(msg) {
				const chatView = document.getElementById("chat");
				chatView.appendChild(CreateMessageView(msg.author, msg.text, msg.color));
			});

			document.getElementById("input-form").addEventListener("submit", (e) => {
				e.preventDefault();

				const chatInput = document.getElementById("chat-input").value;
				if (chatInput) {
					socket.emit("message", {"text": chatInput});
				}
			});
		</script>
	</body>
</html>
